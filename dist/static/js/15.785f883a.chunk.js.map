{"version":3,"sources":["views/VideoDetails/VideoDetails.js","utils/getExactTime.js","component/common/LazyLoading.js","static/images/loading-error.svg","static/images/loading.svg","component/common/ScrollHeader.js"],"names":["VideoDetails","props","state","details","common","componentDidRecover","getData","componentDidCache","video","pause","cacheLifecycles","didCache","didRecover","this","id","match","params","geiVideoSrc","resultUrl","getVideoDetails","resultDetails","getVideoCommon","resultCommon","obj","data","url","urls","setState","comments","load","length","className","ScrollHeader","height","onClick","history","goBack","title","poster","coverUrl","ref","src","autoHide","disableDefaultControls","seconds","order","rates","map","item","key","commentId","LazyLoading","user","avatarUrl","nickname","content","time","date","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getExactTime","Loading","Component","config","options","error","require","loading","throttleWait","module","exports","setFixed","scrollTop","document","documentElement","headerDOM","headerRef","current","headerAntiShake","style","classList","add","remove","createRef","window","addEventListener","children","removeEventListener"],"mappings":"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","file":"static/js/15.785f883a.chunk.js","sourcesContent":["import React, { Component } from \"react\";\r\nimport {\r\n  Player,\r\n  ControlBar,\r\n  PlayToggle, // PlayToggle 播放/暂停按钮 若需禁止加 disabled\r\n  ReplayControl, // 后退按钮\r\n  ForwardControl, // 前进按钮\r\n  CurrentTimeDisplay,\r\n  TimeDivider,\r\n  PlaybackRateMenuButton, // 倍速播放选项\r\n  VolumeMenuButton,\r\n} from \"video-react\";\r\nimport \"video-react/dist/video-react.css\"; // import css\r\nimport { geiVideoSrc, getVideoDetails, getVideoCommon } from \"../../api/index\";\r\nimport getExactTime from \"../../utils/getExactTime\";\r\nimport Loading from \"../../component/content/Loading\";\r\nimport LazyLoading from \"../../component/common/LazyLoading\";\r\nimport ScrollHeader from \"../../component/common/ScrollHeader\";\r\nclass VideoDetails extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    props.cacheLifecycles.didCache(this.componentDidCache);\r\n    props.cacheLifecycles.didRecover(this.componentDidRecover);\r\n  }\r\n  state = {\r\n    details: {},\r\n    common: [],\r\n  };\r\n  UNSAFE_componentWillMount() {\r\n    this.getData();\r\n  }\r\n  async getData() {\r\n    const id = this.props.match.params.id;\r\n    const resultUrl = await geiVideoSrc(id);\r\n    const resultDetails = await getVideoDetails(id);\r\n    const resultCommon = await getVideoCommon(id);\r\n    const obj = { ...resultDetails.data.data, url: resultUrl.data.urls[0].url };\r\n    this.setState(\r\n      {\r\n        details: obj,\r\n        common: resultCommon.data.comments,\r\n      },\r\n      () => {\r\n        this.video.load();\r\n      }\r\n    );\r\n  }\r\n  componentDidRecover = () => {\r\n    this.getData();\r\n  };\r\n  componentDidCache = () => {\r\n    this.video.pause();\r\n  };\r\n  render() {\r\n    const { details, common } = this.state;\r\n    if (common.length) {\r\n      return (\r\n        <div className={\"video_details\"}>\r\n          <ScrollHeader height={50}>\r\n            <header className={\"header\"}>\r\n              <div className=\"text\">\r\n                <i\r\n                  className={\"iconfont icon-jiantouzuo\"}\r\n                  onClick={() => this.props.history.goBack()}\r\n                ></i>\r\n                <h3>{details.title}</h3>\r\n              </div>\r\n            </header>\r\n          </ScrollHeader>\r\n          <Player\r\n            poster={details.coverUrl}\r\n            ref={(video) => (this.video = video)}\r\n          >\r\n            <source src={details.url} />\r\n            <ControlBar autoHide={false} disableDefaultControls={false}>\r\n              <ReplayControl seconds={10} order={1.1} />\r\n              <ForwardControl seconds={30} order={1.2} />\r\n              <PlayToggle />\r\n              <CurrentTimeDisplay order={4.1} />\r\n              <TimeDivider order={4.2} />\r\n              <PlaybackRateMenuButton rates={[5, 2, 1.5, 1, 0.5]} order={7.1} />\r\n              <VolumeMenuButton />\r\n            </ControlBar>\r\n          </Player>\r\n          <ul className={\"common\"}>\r\n            {common.map((item) => (\r\n              <li key={item.commentId}>\r\n                <LazyLoading src={item.user.avatarUrl} />\r\n                <div className=\"info\">\r\n                  <p>\r\n                    <span>{item.user.nickname}:</span>\r\n                    {item.content}\r\n                  </p>\r\n                  <p>{getExactTime(item.time)}</p>\r\n                </div>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n      );\r\n    } else {\r\n      return <Loading />;\r\n    }\r\n  }\r\n}\r\n\r\nexport default VideoDetails;\r\n","export default function (time) {\r\n    const date = new Date(time);\r\n    const year = date.getFullYear() + '-';\r\n    const month = (date.getMonth()+1 < 10 ? '0' + (date.getMonth()+1) : date.getMonth()+1) + '-';\r\n    const dates = date.getDate() + ' ';\r\n    const hour = date.getHours() + ':';\r\n    const min = date.getMinutes() + ':';\r\n    const second = date.getSeconds();\r\n    return year + month + dates + hour + min + second ;\r\n}\r\n","import React from 'react'\r\n// 引入图片懒加载的插件\r\nimport Lazyload from \"r-img-lazyload\";\r\n\r\nfunction LazyLoading (props) {\r\n    // 我们使用图片懒加载的目的是缓解首屏加载的压力，优化用户体验\r\n\r\n    // 配置图片懒加载\r\n    const config = {\r\n        // 其他配置项\r\n        options: {\r\n            error: require(\"../../static/images/loading-error.svg\"), // 加载失败后展示的图像\r\n            loading: require(\"../../static/images/loading.svg\"), // 加载中展示的图像\r\n            throttleWait: 1000 // 节流等待时间\r\n        },\r\n        // 图片地址\r\n        src: props.src\r\n    };\r\n    return <Lazyload {...config}/>\r\n}\r\n\r\nexport default LazyLoading\r\n","module.exports = __webpack_public_path__ + \"static/media/loading-error.99e68751.svg\";","module.exports = __webpack_public_path__ + \"static/media/loading.0bab9ee3.svg\";","import React, { Component, createRef } from 'react'\r\n// 处理头部固定定位的时候 抖动问题的组件\r\n// 启动fixed定位的时候 我们要有一个节点来进行防抖(设置高)，否则会有抖动的问题\r\nexport default class ScrollHeader extends Component {\r\n    constructor (props) {\r\n        super(props)\r\n        // ref标记头部的节点\r\n        this.headerRef = createRef()\r\n        // ref标记头部节点的防抖层\r\n        this.headerAntiShake = createRef()\r\n    }\r\n    componentDidMount () {\r\n        window.addEventListener('scroll', this.setFixed)\r\n    }\r\n    // 设置头部是否可以为fixed定位进行展示\r\n    setFixed = () => {\r\n        /* \r\n            props参数\r\n                height：固定防抖层的高度\r\n        */\r\n        const scrollTop = document.documentElement.scrollTop\r\n        const headerDOM = this.headerRef.current\r\n        if (scrollTop > 0) {\r\n            this.headerAntiShake.current.style.height = this.props.height + 'px'\r\n            headerDOM.classList.add('header_fixed')\r\n        } else {\r\n            headerDOM.classList.remove('header_fixed')\r\n            this.headerAntiShake.current.style.height = null\r\n        }\r\n    }\r\n    render() {\r\n        return (\r\n            <div ref={this.headerAntiShake}>\r\n                <section className=\"\" ref={this.headerRef}>\r\n                    {this.props.children}\r\n                </section>\r\n            </div>\r\n        )\r\n    }\r\n    // 组件销毁的时候清除定时器\r\n    componentWillUnmount () {\r\n        window.removeEventListener('scroll', this.setFixed)\r\n    }\r\n}\r\n"],"sourceRoot":""}